---
layout: post
---

{{ content }}

{% for collec in site.collections %}
    {% if collec.label == page.collection %}
        {% if collec.index_list_pages %}
            <ul>
            {% assign collecs_sorted = collec.docs | sort: "title" %}            
            {% for collec_item in collecs_sorted %}            
                {% assign filename = collec_item.url | split: "/" %}
                {% if filename[-1] != "index" %}
                    {% comment %}
                        If there is something wrong with the file, show the filename (and extension) without linking to the page. Also state what is wrong.
                    {% endcomment %}                   

                    {% assign list_item = "" %}
                    {% assign error = "" %}
                    {% assign title = collec_item.title %}
                    {% if title == '' %}
                        {% comment %}File name has no title in its YAML front matter.{% endcomment %}
                        {% assign error = error | append: '<span class="bad-page-error no-title">Page must have a title. </span>'%}
                    {% endif %}
                    {% assign filename_arr = collec_item.path | split: "/" %}
                    {% assign filename_full = filename_arr.last %}
                    {% assign filename_ext_arr = filename_full | split: "." %}
                    {% assign filename_ext = filename_ext_arr.last %}                    
                    {% if filename_full == filename_ext %}
                        {% comment %}File name has no extension.{% endcomment %}
                        {% assign error = error | append: '<span class="bad-page-error bad-filename">Page file names must end in ".md" or ".html". </span>'%}
                    {% endif %}

                    {% if error == '' %}                        
                        {% assign page_href = collec_item.url | prepend: site.baseurl %}
                        {% assign list_item = '<a href="' | append: page_href | append: '">' | append: title | append: '</a>' %}
                    {% else %}
                        {% assign github_url = "https://github.com/" | append: site.github_user_or_organisation | append: site.baseurl %}
                        {% assign github_edit_url = github_url | append: "/edit/master/collections/" | append: collec_item.path  %}
                        {% assign list_item = '"' | append: filename_full | append: '" ' | append: '<span class="bad-page">[' | append: error | append: '<span class="bad-page-edit"><a href="' | append: github_edit_url | append: '">Click here to edit the page</a></span>.]</span>' %}
                    {% endif %}
                    
                    <li>{{ list_item }}</li>
                {% endif %}
            {% endfor %}
            </ul>
        {% endif %}
    {% endif %}
{% endfor %}

{% assign github_new_url = "https://github.com/" | append: site.github_user_or_organisation | append: site.baseurl | append: "/new/master/" %}
{% if page.collection %}
    {% assign github_new_url = github_new_url | append: "collections/" %}
{% endif %}
{% assign collec = site.collections | where: "label", page.collection | first %}
{% assign github_new_url = github_new_url | append: collec.relative_directory %}

<a href="{{ github_new_url }}" class="add-exp-button">+ add {{ collec.add_new_name }}</a>
